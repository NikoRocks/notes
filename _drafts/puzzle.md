---
layout: index
title: Puzzle
---

В  курсе  [Algorythms:  Design  and  Analysis][algo  course]  на  Coursera  (на
который, к  слову, забил,  предпочев книжке Кормена)  посоветовали [Mathematics
for  Computer  Science][book] за  авторством  двух  товарищей из  Принстонского
университета, дабы восполнить пробелы в необходимом математическом бэкграунде.

Начал читать, весьма  понравилась, в главе про  доказательство с использованием
индукции  так  понравился пример  использования  оной,  что решил  перевести  и
поделиться. По  моему, весьма хороший  пример процесса доказательства  вообще и
доказательства с использованием математической индукции в частности.

Итак, есть  мозайка. Она  состоит из пятнадцати  пронумерованных ячеек  и одной
пустой, находящихся в сетке 4 на 4. Любая пронумерованная ячейка, соседствующая
с пустой,  может быть перемещена в  сторону постой. К примеру,  ниже изображены
два последовательных движения:

     1   2   3   4       1   2   3   4       1   2   3   4
     5   6   7   8  →    5   6   7   8  →    5   6   7   8
     9  10  11  12       9  10  11  12       9  10      12
    13  15  14          13  15      14      13  15  11  14

В самом левом состоянии мазайки выше ячейки 14 и 15 идут не по порядку. Сможете
ли вы найти такую последовательность  перемещений, которые расставят все ячейки
в нужном порядке? После нескольких экспериметов ответом, вероятно, будет "нет".
Но давайте попробуем это доказать.

Мы  будем   использовать  подход,   который  часто  используется   при  аналезе
программных  продуктов  и систем.  Мы  будем  смотреть на  инвариант,  свойство
мазайки,  которое всегда  остается истинным,  вне зависимости  от того,  как вы
двигаете ячейки.  Если мы сможем показать,  что перемена ячеек 14  и 15 местами
нарушит инвариант, значит мы можем подытожить, что это невозможно.

Итак, приступим. Вот теорема, которую мы пытаемся доказать:

**Теорема 1.** *Нет такой последовательности перемещений ячеек, которые изменят
мозайку из состояния, изображенного внизу слева в состояние, изображенное внизу
справа.*

     1   2   3   4      1   2   3   4
     5   6   7   8      5   6   7   8
     9  10  11  12      9  10  11  12
    13  15  14         13  14  15

Мы   будем  выстраивать   последовательность  наблюдений   в  виде   лемм.  Как
только  будет  достигнута критическая  масса,  мы  объединим эти  наблюдения  в
непосредственно доказательство.

Определим  движение  строки  как  движение,  при  котором  ячейки  перемещаются
горизонтально, и движение столбца как движение, при котором ячейки перемещаются
вертикально.  Условимся, что  ячейки  читаются слева  направа  сверху вних  как
обычный английский текст; то есть, когда мы говорим, что ячейки расставлены "не
по порядку", мы подразумеваем, что больший номер ячейки находится перед меньшим
в заданном порядке.

Сложность в  нашем случае  в том,  что одна пара  ячеек (14  и 15)  находится в
неверном порядке  изначально. Из этого  сразу же можно сделать  наблюдение, что
простое  движение строки  не  сильно  помогает нам  в  нашем доказательстве,  а
именно:

**Лемма 2.** *Движение строки не меняет порядок ячеек*

Обычно лемма требует  доказательства. Тем не менее, в данном  случае нет ничего
более  убедительного, чем  непосредственно наблюдение,  поэтому мы  оставим это
высказывание и двинемся дальше, к движениям столбцов.

**Лемма  3.** *Движение  столбца меняет  относительный порядок  ровно трех  пар
ячеек*

К примеру, движение стобца, изображенное ниже, меняет относительный порядок пар
ячеек (j, g), (j, h) и (j, i).

    a  b  c  d      a  b  c  d
    e  f     g  →   e  f  j  g
    h  i  j  k      h  i     k
    l  m  n  o      l  m  n  o

*Доказательство.* Движение  ячейки вних смещает ее  относительно следующих трех
ячеек, идущих следом. Движение ячейки вверх смещает ее относительно трех ячеек,
идущих перед ней. □

Эти наблюдения показывают,  что существуют ограничение на то,  как ячейки могут
меняться местами. Некоторые такие ограничения  могут привести нас к нужному нам
инварианту.  Чтобы рассуждать  об  обмене ячеек  местами  более точно,  давайте
сделаем определение: пара ячеек i и j инвертирована,  если i < j, но при этом i
находится  после j  в нашей  мозайке.  К примеру,  в мозайке  ниже есть  четыре
инвертированных ячейки: (12, 11), (13, 11), (15, 11) и (15, 14).

     1   2   3   4
     5   6   7   8
     9  10      12
    13  15  11  14

Давайте рассмотрим эффекты движений строк и столбцов в терминах инверсии ячеек.

**Лемма  4.**  *Движение строки  никогда  не  меняет четность  числа  инверсий.
Движение столбца всегда меняет четность числа инверсий.*

"Четность" числа говорит  о том, является оно четным либо  нечетным. К примеру,
числа 7 и -5 - нечетные, а 18 и 0 - четные.

*Доказательство.* Согласно  лемме 2, движение  строки не меняет  порядок ячеек;
таким образом, в частности, движение строки не меняет числа инверсий.

Согласно лемме 3, движение столбца  меняет относительный порядок ровно трех пар
ячеек.  Таким  образом,  инвертированная пара  становится  неинвертированной  и
наоборот. Таким  образом, один обмен  меняет четность общего числа  инверсий на
противоположную, второй  меняет ее  в исходное  значение, а  третий -  вновь на
противоположную. □

Эта лемма подразумевает,  что мы должны сделать  *нечетное* количество движений
колонок с  целью поменять только  одну пару ячеек (например,  14 и 15).  Но это
проблематично, поскольку  каждое движение  колонки также двигает  пустую ячейку
вверх или  вниз на  одну строку. Потому  после *нечетного*  количества движений
колонок невозможна  ситуация, когда  пустая ячейка  возвратилась бы  в исходное
положение  в последней  строке!  Теперь  мы можем  связать  все эти  наблюдения
и  вывести  инвариант,  свойство  паззла,  которое  никогда  не  меняется,  вне
зависимости от того, как вы перемещаете ячейки.

**Лемма 5.**  *В каждой конфигурации,  достижимой из позиции,  показанной ниже,
четность количества  инверсий отличается от четности  строки, содержащей пустую
ячейку.*

    строка 1     1   2   3   4
    строка 2     5   6   7   8
    строка 3     9  10  11  12
    строка 4    13  15  14

*Доказательство.* Мы используем индукцию.  Пусть *P(n)* будет утверждением, что
после *n* движений, четность количества инверсий отличается от четности строки,
содержащей пустую ячейку.

*База:* После нуля движений, ровно одна пара ячеек инвертирована (14 и 15), что
является нечетным  числом. И пустая ячейка  находится в строке 4,  что является
четным числом. Таким образом, *P(0)* истинно.

*Шаг индукции:* Теперь мы должны доказать, что из *P(n)* следует *P(n + 1)* для
всех *n ≥ 0*. Итак, предположим, что *P(n)* истинно;  таким образом, после *n*
движений четность количества инверсий отличается от четности строки, содержащей
пустую ячейку. Имеем два случая:

1.  Допустим движение  *n  +  1* это  движение  строки.  Тогда четность  общего
количества инверсий не  меняется согласно Лемме 2.  Четность строки, содержащей
пустую ячейку,  также не меняется,  поскольку пустая  ячейка остается в  той же
строке. Следовательно, эти две четности также  различаются после *n + 1* шагов,
потому *P(n + 1)* истинно.

2.  Допустим, движение  *n +  1* это  движение колонки.  Тогда четность  общего
количества  инверсий  меняется  согласно  Лемме  2.  Однако,  четность  строки,
содержащей  пустую ячейку,  также  меняется, поскольку  пустая ячейка  движется
вверх или  вниз на одну строку.  Таким образом, четности остаются  различными и
после *n + 1* ходов, и потому *P(n + 1)* снова истинно.

Таким образом,  из *P(n)*  следует *P(n  + 1)* для  всех *n  ≥ 0*.  По принципу
индукции, *P(n)* истинно для всех *n ≥ 0*. □

**Теорема 1.** *Нет такой последовательности перемещений ячеек, которые изменят
мозайку из состояния, изображенного внизу слева в состояние, изображенное внизу
справа.*

     1   2   3   4      1   2   3   4
     5   6   7   8      5   6   7   8
     9  10  11  12      9  10  11  12
    13  15  14         13  14  15

*Доказательство.* В целевой конфигурации справа общее количество инверсий равно
нулю,  что является  четным  числом,  и пустая  ячейка  находится  в строке  4,
что  тоже  является  четным  числом. Согласно  Лемме  3,  целевая  конфигурация
недостижима.



[algo course]: https://www.coursera.org/course/algo
[book]: http://www.cs.princeton.edu/courses/archive/spr10/cos433/mathcs.pdf
