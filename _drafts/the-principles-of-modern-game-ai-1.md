---
title: Принципы современного игрового ИИ. Первая неделя
---

## 1.1 Архитектура агента

Классическая схема вычислительного процесса интерактивного агента, пришедшая из
области робототехники, это связка "ощущаю - думаю - действую".

На первом этапе агент собирает, как-то преобразует и запоминает
ту или иную информацию из внешнего мира с помощью
специализированных сенсоров. На этапе обдумывания происходит анализ
накопленной информации с целью определить, какие действия необходимо совершить
для достижения поставленных целей. И, собственно, после этого происходит черед
совершать дейтсвия. Тем не менее, каждый из этих шагов может быть весьма
сложен: при принятии того или иного решения может потребоваться дополнительная
информация из окружающего мира, и необходимо будет сделать дополнительный
запрос к сенсорам; при планировании может использоваться механизм
предугадывания результата действий, то есть может быть задействована
подсистема, отвечающая за исполнение действий. Таким образом, каждый из этапов
не быть выделен явно и размазан по коду.

Альтернативная архитектура заключается в выделении функциональных слоев, каждый
из которых отвечает за тот или иной аспект работы движка - например, физику,
анимацию, поведение и так далее. Поток управления в таком случая перестает быть
горизонтальным и становится вертикальным: каждый слой строится поверх другого.
Внутри каждого из слоев, впрочем, логика поведения остается схожей - мы
анализируем внешние данные для генерации тех или иных действий. С другой
стороны, не каждый из слоев непосредственно сам меняет состояние ИА - для этого
может потребоваться использовать фнукционал других слоев. Например, слой
навигации после генерации оптимального маршрута может обратиться к слоям физика
и анимации.

![](/images/the-principles-of-modern-game-ai/1/1-layers.jpg)

Такая
архитектура дает следующие приемущества:

- очевидная структура агента в коде
- упрощение внутренних кросс-зависимостей в коде
- и, как следствие, упрощение поддержки, в том числе с целью удаления, если
  в следующей игре, использующей тот же движок, исчезнет необходимость
  поддерживать тот или иной аспект работы движка

С целью повысить эффективность вычислений и модульность кода, может иметь смысл
выделить код, отвечающий за взаимодействие с игровым движком, в отдельные
системы: систему физики, анимации и т. д., предоставляющих высокоуровневый
интерфейс для соответствующих компонентов;
в них же могут шарится общая для всех агентов информация и алгоритмы.

## 1.2 Поток информации

Можно выделить несколько фаз при работе интерактивного агента. Первая и
последняя фаза обязательно, но остальные могут быть присущи не всем агентам -
когда, например, не требуется чрезвычайно сложное, человекоподбное поведение.

*Извлечение* информации из игрового мира и преобразование её в структуры, более
подходящие для обработки внутри ИА.

*Обработка* извлеченной информации: преобразование и объединение её в более сложные
структуры для последующих фаз работы.

*Обдумывание* имеющейся информации с целью дополнения общей картины фактами,
которые можно построить на основе извлеченной информации, но которые отсутсвуют
а ней напрямую - например, предположение о текущем положении игрока.

*Принятие решения*, исходя из целей существования ИА и результатов работы
предыдущей фазы. На этом этапе могут использоваться алгоритмы построения
оптимального пути, предположения о том, какие реакции последуют в ответ на те
или иные действия ИА и так далее.

*Генерация* структур данных, пригодных для конвертации в примитивные операции
игрового движка, на основе принятых решений.

*Конвертация* принятых решений обратно в низкоуровневые понятия игрового движка
- перемещение в пространстве, отыгрывание анимаций и так далее.

Сущесвует два подхода к тому, как будет оповещаться интерактивный агент об
изменениях окружающего его мира. Первый подход - *поллинг*, когда агент сам, на
периодической основе, опрашивает мир об изменениях. Такой подход хорошо
применять в случае, если мир обновляется довольно части - иначе оверхэд на
опрос информации будет лишним. Альтернатива ему, в случае, когда изменения
происходят редко - *пушинг*, когда ИА
подписывается не накоторые события игрового мира, и уведомляется о них при их
наступлении.

![](/images/the-principles-of-modern-game-ai/1/2-polling.jpg)

Разумеется, можно применять гибридный вариант, когда некоторые
данные окружающего мира изменяются часто и агент обновляет их самостоятельно
путем опроса, а для других, менее часто обновляемых данных, используется
система подписки на изменения.
